# 交互式物流路径规划系统 - 使用指南

## 🚀 快速开始

### 运行方式

```bash
python scripts/logistics-router-interactive.py
```

程序启动后会提示选择运行模式:
- **模式1: 交互式配置** (推荐) - 通过问答方式自定义所有参数
- **模式2: 默认配置演示** - 快速查看系统功能

---

## 📋 交互式配置流程

### 第一步: 基础配置

系统会依次询问:

1. **配送点数量** (1-10个)
   - 示例: 输入 `3` 表示3个配送点
   - 默认: 3

2. **车辆载重** (kg)
   - 示例: 输入 `150` 表示150公斤
   - 默认: 150

3. **最大行驶距离** (km)
   - 示例: 输入 `100` 表示100公里
   - 默认: 100

4. **平均车速** (km/h)
   - 示例: 输入 `40` 表示时速40公里
   - 默认: 40

---

### 第二步: 仓库位置配置

**选项1: 使用默认仓库**
```
使用默认仓库位置 (广州) (Y/n): 
```
- 按回车或输入 `Y` 使用广州默认位置 (23.1291, 113.2644)

**选项2: 自定义仓库**
```
使用默认仓库位置 (广州) (Y/n): n
  纬度: 39.9042
  经度: 116.4074
```

---

### 第三步: 配送点信息配置

系统会为每个配送点依次询问:

#### 位置信息
- **使用随机位置** (推荐用于测试)
  - 系统会在仓库附近随机生成坐标
- **手动输入GPS坐标**
  ```
  使用随机位置 (Y/n): n
    纬度: 23.1350
    经度: 113.2700
  ```

#### 配送需求
1. **需求量** (kg) - 该点需要配送的货物重量
2. **服务时长** (分钟) - 在该点卸货装货的时间
3. **优先级** (1-5) - 1为最高优先级

#### 时间窗
- **时间窗开始** - 几小时后开始允许配送
- **时间窗结束** - 几小时后停止配送

示例:
```
配送点 1/3:
  使用随机位置 (Y/n): Y
  需求量 (kg) (默认: 30): 50
  服务时长 (分钟) (默认: 15): 20
  优先级 (1-5, 1最高) (默认: 1): 1
  时间窗开始 (几小时后) (默认: 1): 1
  时间窗结束 (几小时后) (默认: 3): 4
```

---

### 第四步: 算法配置

选择优化算法:

```
选择优化算法
  1. 最近邻启发式 (快速)
  2. 遗传算法 (精确)
  3. 多目标优化 (平衡成本/时间/排放)
  4. 全部运行对比
请选择 (1-4): 
```

#### 算法详解

**1. 最近邻启发式**
- ⚡ 速度: 最快
- 🎯 精度: 中等
- 📝 说明: 每次选择最近的未访问点
- 适用场景: 配送点较多,需要快速得到可行解

**2. 遗传算法**
- ⚡ 速度: 较慢
- 🎯 精度: 最高
- 📝 说明: 通过模拟进化过程优化路径
- 适用场景: 配送点较少,需要最优解

需要配置:
```
遗传算法参数:
  种群大小 (默认: 50): 100
  迭代代数 (默认: 100): 200
```
- 种群越大、代数越多 = 精度越高但速度越慢

**3. 多目标优化**
- ⚡ 速度: 中等
- 🎯 精度: 高
- 📝 说明: 综合考虑成本、时间、碳排放
- 适用场景: 需要平衡多个指标

需要配置权重:
```
多目标优化权重 (总和应为1.0):
  成本权重 (默认: 0.4): 0.5
  时间权重 (默认: 0.4): 0.3
  排放权重 (默认: 0.2): 0.2
```

**4. 全部运行对比**
- 依次运行所有算法,对比结果

---

## 📊 结果解读

### 最近邻启发式结果

```
【最近邻启发式算法】
配送顺序:
  1. point_a - 需求:50kg, 服务:15分钟
  2. point_c - 需求:40kg, 服务:20分钟
  3. point_b - 需求:30kg, 服务:10分钟
✅ 成功配送: 3/3 个点
```

**说明:**
- 按照最优顺序访问各配送点
- 自动满足车辆容量、时间窗约束
- 如果某些点无法配送,会显示 `成功配送: 2/3 个点`

---

### 遗传算法结果

```
【遗传算法优化】
优化路径:
  1. point_a - 需求:50kg
  2. point_b - 需求:30kg
  3. point_c - 需求:40kg
总距离: 15.73 km
```

**说明:**
- 给出最优配送顺序
- 显示总行驶距离

---

### 多目标优化结果

```
【多目标优化】
优化路径:
  1. point_a
  2. point_c
  3. point_b

综合指标:
  💰 总成本: ¥156.45
  ⏱️  总时间: 1.85 小时
  🌱 碳排放: 2.36 kg CO2
```

**指标说明:**
- **总成本** = 燃油费 + 人工费
  - 燃油: 0.8元/km
  - 人工: 50元/小时
- **总时间** = 行驶时间 + 服务时间
- **碳排放** = 行驶距离 × 0.15 kg/km

---

## 💡 使用技巧

### 1. 快速测试
```
配送点数量: 3
使用默认仓库: Y
使用随机位置: Y (对所有配送点)
算法: 4 (全部运行对比)
```

### 2. 实际应用场景

**场景A: 城市配送**
```
配送点数量: 5-8
车辆载重: 500-1000 kg
最大行驶距离: 50 km
平均车速: 30 km/h (考虑城市拥堵)
算法: 遗传算法 (精确路径)
```

**场景B: 长途运输**
```
配送点数量: 3-5
车辆载重: 5000-10000 kg
最大行驶距离: 300 km
平均车速: 60 km/h
算法: 多目标优化 (考虑油耗和时间)
```

**场景C: 紧急配送**
```
配送点数量: 2-3
时间窗: 窄时间窗 (1-2小时)
优先级: 全部设为1 (最高)
算法: 最近邻 (快速响应)
```

### 3. 参数调优建议

| 配送点数量 | 推荐算法 | 遗传算法参数 |
|-----------|---------|-------------|
| 1-3个 | 最近邻 | - |
| 4-6个 | 遗传算法 | 种群50, 代数100 |
| 7-10个 | 遗传算法 | 种群100, 代数200 |
| 10个以上 | 最近邻 | - |

---

## ❓ 常见问题

### Q1: 为什么显示"成功配送: 2/3 个点"?

**可能原因:**
1. 车辆容量不足 - 增加车辆载重
2. 时间窗冲突 - 调整时间窗范围
3. 超出最大行驶距离 - 增加最大行驶距离

### Q2: 遗传算法运行很慢?

**解决方法:**
- 减少种群大小 (如50 → 30)
- 减少迭代代数 (如100 → 50)
- 或改用最近邻算法

### Q3: 多个算法结果差异很大?

**说明:**
- 这是正常现象,不同算法有不同优化目标
- 最近邻: 优先考虑距离最短
- 遗传算法: 全局最优
- 多目标: 综合平衡

### Q4: 如何保存配置?

目前暂不支持配置保存,建议:
1. 记录关键参数
2. 修改代码中的默认值
3. 或使用默认配置模式

---

## 🔧 高级用法

### 修改成本参数

编辑 `MultiObjectiveOptimizer._calculate_cost()`:
```python
fuel_cost_per_km = 0.8  # 修改燃油成本
driver_cost_per_hour = 50  # 修改人工成本
```

### 修改排放参数

编辑 `MultiObjectiveOptimizer._calculate_emission()`:
```python
emission_per_km = 0.15  # 修改排放因子 (kg CO2/km)
```

---

## 📞 技术支持

如遇到问题或有改进建议,请:
1. 检查输入参数是否合理
2. 尝试使用默认配置模式
3. 查看控制台错误信息
